var searchQuest="";var currentSector=1;$(document).ready(function(){$("#currentSector").html(currentSector);$("#previousPage").click(function(b){b.preventDefault();currentSector=currentSector-1;if(currentSector<1){currentSector=1}$("#currentSector").html(currentSector);search()});$("#nextPage").click(function(b){b.preventDefault();currentSector=currentSector+1;$("#currentSector").html(currentSector);search()});$("#m_ratePic").click(function(){$(this).removeClass("btn-warning");$("#mv_detailed").slideUp("fast");$("#mv_rate").slideDown("fast");$("#m_sendRating").attr("pictureID",$(this).attr("pictureID"));$(".rateStar").each(function(){$(this).removeClass("text-success").removeClass("fas").addClass("far")})});var a;$(".rateStar").each(function(){$(this).hover(function(){if(!$(this).hasClass("text-success")){$(this).removeClass("far").addClass("fas");$(this).prevAll().removeClass("far").addClass("fas");$(this).nextAll().removeClass("fas").addClass("far")}});$(this).mouseleave(function(){if(!$(this).hasClass("text-success")){$(this).removeClass("fas").addClass("far")}});$(this).click(function(){$(this).addClass("text-success");a=($(this).prevAll().length+1);$(this).prevAll().addClass("text-success");$(this).nextAll().removeClass("text-success").addClass("far")})});$("#m_sendRating").click(function(){var b=$(this).attr("pictureID");$.ajax({method:"POST",url:"./call/rate.php",data:{pictureID:b,stars:a},success:function(c){if(c){alert("Error while saving rating: "+c)}else{$("#m_ratePic").removeClass("btn-warning");$("#mv_rate").slideUp("fast");$("#mv_detailed").slideDown("fast");buildModal(b)}}})})});function buildModal(a){get(a,function(f){var d=(JSON.parse(f))[0];var c=(JSON.parse(f))[1];$("#m_ratePic").attr("pictureID",a);$("#m_titleHead").html(d.img_title);$("#m_title").html(d.img_title);$("#m_image").attr("src","include/img/useruploads/"+d.img_path_preview);$("#m_description").html(d.img_description);$("#m_views").html(d.views);$("#m_rating_full").html(d.rating);$("#m_date").html(d.created);$("#m_downloadOriginal").attr("href","include/img/useruploads/"+d.img_path_full);for(var b=1;b<=5;b++){if(b<=Math.round(d.rating)){if(Math.round(d.rating)-d.rating<=0.5&&b>d.rating){$("#faStar"+b).removeClass("far").addClass("fas").addClass("fa-star-half")}else{$("#faStar"+b).removeClass("far").addClass("fas").addClass("fa-star")}}else{$("#faStar"+b).removeClass("fas").removeClass("fa-star-half").addClass("far").addClass("fa-star")}}var e="";for(var b=0;b<c.length;b++){if(c[b]){e=e+c[b]+" "}}$("#m_tags").html(e);$("#pictureModal").modal("show")})}function search(){clearInterval(searchQuest);searchQuest=setInterval(function(){$("#galleryContainer").html("");console.log("Query: Find '"+key+"' ordered by '"+sorting+"'");$.ajax({method:"POST",url:"./call/galery.php",data:{key:key,sorting:sorting,currentSector:currentSector},success:function(a){if(a.indexOf("!dbinit!")>=0){$("#successText").html("Database has been created. You should reload this page now.");$("#successAlert").slideDown("slow")}buildGalery(JSON.parse(a))}});clearInterval(searchQuest)},500)}function buildGalery(c){var b="";if(c.length){b="";var a="";$.get("./include/galeryEntry.html",function(e){for(var d=0;d<c.length;d++){a=e;a=a.replace("##IMAGEID##",c[d][0]);a=a.replace("##SMALLIMAGE##",c[d][1]);a=a.replace("##BIGIMAGE##",c[d][2]);b+=a}$("#galleryContainer").html(b)})}else{$("#galleryContainer").html('<div class="col-12 text-center"><p>No Pictures found.</p></div>')}}function get(a,b){$.ajax({method:"POST",url:"./call/image.php",data:{pictureID:a},success:function(c){if(c){if(c!=-1){b(c)}else{}}else{}}})};